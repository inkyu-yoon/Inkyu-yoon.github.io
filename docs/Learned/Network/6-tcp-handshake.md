---
layout: post
title: "Β· 3 Way Handshakeμ™€ 4 Way Handshakeλ” λ¬΄μ—‡μΈκ°€μ”?"
nav_order: 6
parent : Network
grand_parent: π“Learned
permalink: docs/Learned/Network/tcp-handshake
---

# 3 Way Handshakeμ™€ 4 Way Handshakeλ” λ¬΄μ—‡μΈκ°€μ”?
{: .no_toc }

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---


{: .important-title}
> ν•µμ‹¬
>
> 3-way handshakeμ κ²½μ° μ—°κ²°μ„ μλ¦½ν•λ” κ³Όμ •μ—μ„ μ§„ν–‰λκ³  4-way handshakeμ κ²½μ° μ—°κ²°μ„ ν•΄μ ν•λ” κ³Όμ •μ—μ„ μ§„ν–‰λ©λ‹λ‹¤.
> 
> 3-way handshakeλ” ν΄λΌμ΄μ–ΈνΈκ°€ SYN ν¨ν‚·μ„ μ„λ²„μ— μ „μ†΅μ— μ—°κ²°μ„ μ”μ²­ν•λ©΄ μ„λ²„λ” ACKμ™€ SYN ν¨ν‚·μΌλ΅ μ‘λ‹µν•©λ‹λ‹¤.
> 
> κ·Έλ¦¬κ³  ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²° ν™•μ •μ„ μ„ν• ACK ν¨ν‚·μ„ λ³΄λ‚΄λ©΄μ„ λ§λ¬΄λ¦¬λ©λ‹λ‹¤.
> 
> μ΄ κ³Όμ •μ΄ 3λ²μ— κ±Έμ³ μ΄λ£¨μ–΄μ Έ 3-way handshakeλΌ λ¶λ¦½λ‹λ‹¤.
>
> 
> 4-way handshakeλ” μ—°κ²°μ„ ν•΄μ ν• λ• μ§„ν–‰λ©λ‹λ‹¤.
> 
> μ—°κ²° ν•΄μ λ¥Ό μ„ν•΄ FIN ν¨ν‚·μ„ μ „μ†΅ν•©λ‹λ‹¤.
> 
> FIN ν¨ν‚·μ„ λ°›μ€ μ½μ€ ACK ν¨ν‚·μΌλ΅ μ°μ„  μ‘λ‹µν•©λ‹λ‹¤.
> 
> λ‚¨μ€ μ‘μ—…μ„ λ§μΉκ³  FIN ν¨ν‚·μ„ μ—°κ²° ν•΄μ λ¥Ό μ”μ²­ν–λ μ½μΌλ΅ μ „μ†΅ν•©λ‹λ‹¤.
> 
> μ—°κ²° ν•΄μ  μ”μ²­μ„ ν–λ μ½μ€ ACKλ¥Ό μ‘λ‹µν•¨μΌλ΅μ„ λ§λ¬΄λ¦¬λ©λ‹λ‹¤.



## **3-way handshakeλ€?**

TCP/IP ν”„λ΅ν† μ½μ„ μ΄μ©ν•΄μ„ ν†µμ‹ μ„ ν•λ” μ‘μ©ν”„λ΅κ·Έλ¨μ΄ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ „μ— λ¨Όμ € μ •ν™•ν• μ „μ†΅μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ μƒλ€λ°© μ»΄ν“¨ν„°μ™€ μ‚¬μ „μ— μ„Έμ…μ„ μλ¦½ν•λ” κ³Όμ •μ΄λ‹¤.  
 
<div align = "center">

<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230628160110371.png" alt="image-20230628160110371" style="zoom:80%;" />

</div>

### Client State

1. **CLOSED** : λ°μ΄ν„°λ¥Ό μ£Όκ³  λ°›κΈ° μ „ μ—°κ²°μ΄ μ•λ κΈ°λ³Έ μƒνƒλ¥Ό μλ―Έν•λ‹¤.  

2. **SYN-SENT** : ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ SYNμ„ λ³΄λƒλ‹¤λ” μƒνƒ, μ„λ²„μΈ΅μ μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬κ³  μλ” μƒνƒλ¥Ό μλ―Έν•λ‹¤.  

3. **LISTEN** : CLOSED μƒνƒμ— μλ μ„λ²„κ°€ λ°μ΄ν„°λ¥Ό λ°›μ„ μ¤€λΉ„κ°€ λμ–΄ λ€κΈ°ν•λ” μƒνƒλ¥Ό μλ―Έν•λ‹¤.  

4. **SYN-RECEIVED** : ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ λ³΄λ‚Έ SYNμ„ μ„λ²„ μΈ΅μ—μ„ μ λ°›μ•λ‹¤λ” μƒνƒλ¥Ό μλ―Έν•λ‹¤.  

5. **ESTABLISHED** : μ—°κ²°μ΄ μ„±κ³µμ μΌλ΅ λμ—λ‹¤λ” μƒνƒλ¥Ό μλ―Έν•λ‹¤. ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„  μ„λ²„μ μ‘λ‹µμ„ λ°›μΌλ©΄ ν•΄λ‹Ή μƒνƒκ°€ λκ³ , μ„λ²„ μΈ΅μ—μ„  μ‘λ‹µμ„ λ³΄λ‚΄κ³  λ‹¤μ‹ ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ λ°μ΄ν„°λ¥Ό λ³΄λ‚΄λ©΄ ν•΄λ‹Ή μƒνƒκ°€ λλ‹¤.  



### 3-way handshake κ³Όμ •

1οΈβƒ£  **Client β†’  Server : SYN**

ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ™€ μ»¤λ„¥μ…μ„ μ—°κ²°ν•κΈ° μ„ν•΄ `SYN` μ„ λ³΄λ‚Έλ‹¤.  

> PORT μƒνƒ
>
> - Client : `CLOSED β†’ SYN_SENT`
> - Server : `LISTEN`



2οΈβƒ£  **Server β†’ Client : ACK+SYN**

μ„λ²„κ°€ `SYN` μ„ λ°›κ³ , ν΄λΌμ΄μ–ΈνΈλ΅ λ°›μ•λ‹¤λ” μ‹ νΈμΈ `ACK` μ™€ `SYN` ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.  

> PORT μƒνƒ
>
> - Client : `CLOSED`
> - Server : `SYN_RECEIVE`



3οΈβƒ£  **Client β†’  Server : ACK**

ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ μ‘λ‹µμ€ ACKμ™€ SYN ν¨ν‚·μ„ λ°›κ³ , ACKλ¥Ό μ„λ²„λ΅ λ³΄λ‚Έλ‹¤.  

λ§μ§€λ§‰μΌλ΅ μ ‘μ† μ”μ²­ ν”„λ΅μ„Έμ¤κ°€ μλ½ ν™•μΈμ„ λ³΄λ‚΄ μ—°κ²°μ„ λ§Ίλ”λ‹¤.  

μ΄λ•, μ „μ†΅ν•  λ°μ΄ν„°κ°€ μμΌλ©΄ μ΄ λ‹¨κ³„μ—μ„ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•  μ μλ‹¤.  

> PORT μƒνƒ
>
> - Client : `ESTABLISED`
> - Server : `SYN_Receive β†’ ESTABLISED`



## **4-way handshakeλ€?**

4-Way Handshakeμ€ μ—°κ²°μ„ ν•΄μ  (Connecntion Termination)ν•λ” κ³Όμ •μ΄λ‹¤.


<div align = "center">

<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230628160739875.png" alt="image-20230628160739875" style="zoom:80%;" />

</div>

### Client State

1. **FIN-WAIT** : ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ μ„λ²„μ— μ—°κ²°μ„ ν•΄μ ν•κ² λ‹¤κ³  μ‹ νΈλ¥Ό λ³΄λ‚Έ μƒνƒλ¥Ό μλ―Έν•λ‹¤.

2. **CLOSE-WAIT** : μ„λ²„ μΈ΅μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ λ¶€ν„° μ—°κ²°μ„ ν•΄μ ν•κ² λ‹¤ μ‹ νΈλ¥Ό λ°›μ€ μƒνƒμ΄λ©°, μ•„μ§ μ „μ†΅μ΄ λλ‚  λ•κΉμ§€ λ€κΈ°ν•λ” μƒνƒμ΄λ‹¤. μ΄λ¬ν• λ€κΈ°ν•λ” μƒνƒλ” μ „μ†΅μ΄ λλ‚μ§€ μ•μ€ λ°μ΄ν„°μ μ†μ‹¤μ„ μλ°©ν•΄μ¤€λ‹¤.

3. **LAST-ACK** : μ„λ²„ μΈ΅μ—μ„ μ „μ†΅μ΄ λλ‚κ³  ν΄λΌμ΄μ–ΈνΈ μΈ΅μΌλ΅ μ „μ†΅μ΄ μ™„μ „ν λλ‚¬λ‹¤λ” μ‹ νΈλ¥Ό λ³΄λ‚Έ μƒνƒμ΄λ‹¤.

4. **TIME-WAIT** : ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ μ„λ²„ μΈ΅μΌλ΅λ¶€ν„° μ „μ†΅μ΄ λλ‚¬λ‹¤λ” μ‹ νΈλ¥Ό λ°›μ€ μƒνƒμ΄λ©°, μ™„μ „ν μ—°κ²°μ„ ν•΄μ ν•  μ¤€λΉ„ν•λ” μƒνƒμ΄λ‹¤. CLOSE-WAITκ³Ό λ§μ°¬κ°€μ§€λ΅ μ „μ†΅μ΄ λλ‚μ§€ μ•μ€ λ°μ΄ν„°μ μ†μ‹¤μ„ μλ°©ν•΄μ¤€λ‹¤.

5. **CLOSED** : μ—°κ²°μ΄ ν•΄μ λ μƒνƒλ΅ ν΄λΌμ΄μ–ΈνΈ μΈ΅κ³Ό μ„λ²„ μΈ΅μ κΈ°λ³Έ μƒνƒκ°€ λλ‹¤.



### 4-way handshake κ³Όμ •

1οΈβƒ£  **Client β†’ Server : FIN**

μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°λ μƒνƒμ—μ„ ν΄λΌμ΄μ–ΈνΈκ°€ close()λ¥Ό νΈμ¶ν•μ—¬ μ ‘μ†μ„ λμΌλ ¤ ν•λ‹¤.  

ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ—κ² μ—°κ²°μ„ μΆ…λ£ν•λ‹¤λ” `FIN` ν”λκ·Έλ¥Ό λ³΄λ‚Έλ‹¤.  

μ΄λ• `FIN` ν¨ν‚·μ—λ” μ‹¤μ§μ μΌλ΅ ACKλ„ ν¬ν•¨λμ–΄μλ‹¤.  

> PORT μƒνƒ
>
> - Client : `ESTABLISHED β†’ FIN_WAIT`
> - Server : `ESTABLISHED`

2οΈβƒ£  **Server β†’ Client : ACK**

μ„λ²„λ” `FIN` μ„ λ°›κ³ , ν™•μΈν–λ‹¤λ” `ACK`λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚΄κ³  μμ‹ μ ν†µμ‹ μ΄ λλ‚ λ•κΉμ§€ κΈ°λ‹¤λ¦°λ‹¤. (μ΄μƒνƒκ°€ TIME_WAIT μƒνƒ)

μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ—κ² μ‘λ‹µμ„ λ³΄λ‚΄κ³  `CLOSE_WAIT` μƒνƒμ— λ“¤μ–΄κ°„λ‹¤.  

**λ‚¨μ€ λ°μ΄ν„°κ°€ μλ‹¤λ©΄ λ§μ € μ „μ†΅μ„ λ§μΉ ν›„μ— close( )λ¥Ό νΈμ¶ν•κΈ° μ„ν•΄μ„μ΄λ‹¤.**  

ν΄λΌμ΄μ–ΈνΈμ—μ„λ” μ„λ²„μ—μ„ `ACK` λ¥Ό λ°›μ€ ν›„μ— μ„λ²„κ°€ λ‚¨μ€ λ°μ΄ν„° μ²λ¦¬λ¥Ό λλ‚΄κ³  `FIN` ν¨ν‚·μ„ λ³΄λ‚Ό λ•κΉμ§€ κΈ°λ‹¤λ¦¬κ² λλ‹¤. (`FIN_WAIT_2`)

> PORT μƒνƒ
>
> - Client : `FIN_WAIT`
> - Server : `ESTABLISHED β†’ CLOSE_WAIT`


3οΈβƒ£  **Server β†’ Client : FIN**

λ°μ΄ν„°λ¥Ό λ¨λ‘ λ³΄λƒλ‹¤λ©΄, μ„λ²„λ” μ—°κ²°μ΄ μΆ…λ£μ— ν•©μ ν•λ‹¤λ” μλ―Έλ΅ `FIN` ν¨ν‚·μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Έ ν›„μ—,    

μΉμΈ λ²νΈλ¥Ό λ³΄λ‚΄μ¤„ λ•κΉμ§€ κΈ°λ‹¤λ¦¬λ” `LAST_ACK` μƒνƒλ΅ λ“¤μ–΄κ°„λ‹¤.  

> PORT μƒνƒ
>
> - Client : `FIN_WAIT`
> - Server : `CLOSE_WAIT β†’ LAST_ACK`


4οΈβƒ£  **Client β†’ Server : ACK**

ν΄λΌμ΄μ–ΈνΈλ” `FIN` μ„ λ°›κ³ , ν™•μΈν–λ‹¤λ” `ACK`λ¥Ό μ„λ²„μ—κ² λ³΄λ‚Έλ‹¤.  

μ•„μ§ μ„λ²„λ΅λ¶€ν„° λ°›μ§€ λ»ν• λ°μ΄ν„°κ°€ μμ„ μ μμΌλ―€λ΅ `TIME_WAIT`μ„ ν†µν•΄ κΈ°λ‹¤λ¦°λ‹¤. (μ‹¤μ§μ μΈ μΆ…λ£κ³Όμ • `CLOSED`μ— λ“¤μ–΄κ°€κ² λλ‹¤.)  

μ΄λ• `TIME_WAIT` μƒνƒλ” **μλ„μΉ μ•μ€ μ—λ¬λ΅ μΈν•΄ μ—°κ²°μ΄ λ°λ“λ½μΌλ΅ λΉ μ§€λ” κ²ƒμ„ λ°©μ§€**ν•λ‹¤.  

λ§μ•½, μ—λ¬λ΅ μΈν•΄ μΆ…λ£κ°€ μ§€μ—°λλ‹¤κ°€ νƒ€μ„μ΄ μ΄κ³Όλλ©΄ `CLOSED`κ°€ λλ‹¤.  

> PORT μƒνƒ
>
> - Client : `TIME_WAIT β†’ CLOSED`
> - Server : `CLOSED`



>  TIME_WAITμ΄λ€? : Clientκ°€ Serverλ΅ λ¶€ν„° FINμ„ μμ‹ ν•λ”λΌλ„ μΌμ •μ‹κ°„(λ””ν΄νΈ 240μ΄) λ™μ• μ„Έμ…μ„ λ‚¨κ²¨λ†“κ³  μ‰μ—¬ ν¨ν‚·μ„ κΈ°λ‹¤λ¦¬λ” κ³Όμ •

