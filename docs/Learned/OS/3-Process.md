---
layout: post
title: "· 프로세스와 스레드"
nav_order: 2
parent : 운영체제
grand_parent: 📚Learned
permalink: docs/Learned/OS/Process
---

# 프로세스와 스레드
{: .no_toc }

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---


## 프로그램과 프로세스

<br>

- 프로그램 : 저장장치에 저장되어 있는 정적인 상태
- 프로세스 : 실행을 위해 메모리에 올라온 동적인 상태

<br>

### 프로그램에서 프로세스로의 전환

<br>

1. 운영체제는 프로그램을 메모리의 적당한 위치로 가져온다. 그와 동시에 제어블록(Process Control Block, PCB)를 만든다.

> PCB는 프로세스를 처리하는 데 필요한 다양한 정보가 들어있다.

2. 프로세스가 종료되면 프로세스가 메모리에서 삭제되고, PCB도 폐기된다.

<br>

## 프로세스의 5 가지 상태

<br>

### 1. 생성 상태

<br>

프로세스가 메모리에 올라오고 PCB가 생성되어 실행 준비를 완료한 상태

<br>

### 2. 준비 상태

<br>

생성된 프로세스가 CPU를 얻을 때 까지 기다리는 상태, CPU가 하나라면 한 번에 하나의 프로세스만 실행할 수 있기 때문에 실행 순서가 될 때까지 기다려야 한다. **CPU 스케줄러가 dispatch(PID)를 실행하면 준비 상태에서 실행 상태로 바뀌어 작업이 이루어진다.**

<br>

### 3. 실행 상태

<br>

준비 상태에 있던 프로세스 중 하나가 작업을 수행하는 상태로 일정 시간 동안 CPU를 사용할 권리를 갖는다. 주어진 시간을 다 사용했다면, 준비 상태로 돌아와 다음 차례를 기다린다.

**시간을 다 사용하면 timeout(PID)가 실행된다. 프로세서 제어 블록을 실행 상태에서 준비 상태로 옮긴다.**

실행 상태에 있는 프로세스가 입출력을 요청하면 **CPU는 입출력 관리자에게 입출력을 요청하고 block(PID)를 실행한다.**

<br>

### 4. 대기 상태

<br>

실행 상태에 있는 프로세스가 입출력을 요청하면 입출력이 완료될 때까지 기다리는 상태이다. 입출력이 완료되면, **인터럽트가 발생하고 wakeup(PID)로 해당 프로세스 제어 블록이 준비 상태로 이동하게 된다.**

<br>

### 5. 완료 상태

<br>

실행 상태의 프로세스가 주어진 시간 동안 작업을 마치면 완료 상태로 돌아간다.

<br>



## 문맥 교환

<br>

문맥 교환은 CPU를 차지하던 프로세스가 나가고 새로운 프로세스를 받아들이는 작업을 말한다.

실행 상태에서 빠져나가는 PCB를 정리하고 실행 상태로 들어오는 PCB를 세팅하는 과정이다.

<br>



## 프로세스의 구조

<br>

프로세스는 코드 영역, 데이터 영역, 스택 영역으로 구성된다.

<br>

1. 코드 영역 : 프로그램의 본문이 기술된 곳으로 읽기 전용으로 처리된다.

2. 데이터 영역 : 데이터 영역은 코드가 실행되면서 사용하는 변수나 파일 등의 각종 데이터를 모아놓은 곳이다. 이곳의 내용은 읽기와 쓰기가 가능하다.

3. 스택 영역 : 스택 영역은 운영체제가 프로세스를 실행하기 위해 부수적으로 필요한 데이터를 모아놓은 곳이다.

<br>

## fork() 시스템 호출

<br>

실행 중인 프로세스로 부터 새로운 프로세스를 복사하는 함수이다. 매번 새로 만드는 것 보다 실행중인 프로세스를 또 요청하게 되는 경우에는 복사하는 방법이 더 효율적이기 때문이다.

프로세스를 복사하게 되면, 복사된 프로세스는 부모 프로세스가 되고, 새로 생긴 프로세스는 자식 프로세스가 되어 부모-자식 관계로 연결된다.

PCB에는 PPID라는 부모 프로세스 구분자와 CPID라는 자식 프로세스 구분자가 있는데,

부모-자식 관계로 연결되면, 부모의 CDIP에는 연결된 자식의 PID(프로세스 구분자)가 입력되고

자식의 PPID에는 연결된 부모의 PID(프로세스 구분자)가 입력된다.

<br>

## exec() 시스템 호출

<br>

프로세스는 그대로 둔 채 내용만 바꾸는 시스템 호출이다.

프로세스 변경을 위해, 새로운 PCB를 만들고 메모리 자리를 확보하는 과정과 종료한 후 메모리를 청소하는 과정 등을 거치지 않을 수 있기 때문에 사용한다.

<br>

## 스레드란?

<br>

프로세스의 코드에 정의된 절차에 따라 CPU에 작업 요청을 하는 실행 단위이다. 즉, 하나의 프로세스에는 여러개의 스레드가 존재한다.

<br>

### 멀티 스레드

<br>

멀티 스레드는 정적인(변화가 없는) 자원들을 공유한다.

<p align="center">
<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230124185836101.png" alt="image-20230124185836101" style="zoom:80%;" />
</p>

fork()의 경우 프로세스 자체를 복사하기 때문에, 변화가 없을 정적인 자원까지 복사되어 불필요한 자원 낭비가 일어날 수 있지만,

멀티 스레드를 적용하면, 변화가 이루어지는 레지스터, 스택 등의 영역만 추가하면 되므로 자원을 효율적으로 사용할 수 있다.

<br>

